<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <title>Alberto Fortuna</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --container-height-l: 50%;
      --container-height: 40%;
      --font-size-l: 2.5vh;
      --font-size: 1.5vw;
      --transition-time: .5s;
      --segment-color: #2c71a3;
    }

    @keyframes lampeggia {
      0%, 100% {
        background-color: var(--segment-color);
      }
      50% {
        background-color: #a3c7e7;
      }
    }

    html body {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      margin: 0;
      height: 100vh;
      width: 100vw;
      font-family: 'Courier New', Courier, monospace;
      overflow: hidden;
    }

    #logo-container {
      z-index:0;
      aspect-ratio: 1 / 1;
      position: relative;
      will-change: transform;
      opacity: 0;
    }

    .content {
      border-radius: 0.5em;
      color: #fff;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background-color: var(--segment-color);
      animation: lampeggia 2s 2;
      font-size: 2.5vh;
      max-height: 160%;
      min-height: 100%;
      transition: all var(--transition-time) ease;
      cursor: pointer;
    }

    .content ul {
      padding-inline-start: 0.5em;
    }

    /* Portrait: usa height */
    @media (orientation: landscape) {
      #logo-container {
        height: var(--container-height-l);
        width: auto;
      }
      .content {
        font-size: var(--font-size-l);
      }
    }

    /* Landscape: usa width */
    @media (orientation: portrait) {
      #logo-container {
        width: var(--container-height);
        height: auto;
      }

      .content {
        font-size: var(--font-size);
      }
    }

    .segment {
      position: absolute;
      transform-origin: top center;
      z-index:0;
    }

    .left {
      top: 0%;
      right: 47.5%;
      width: 4%;
      height: 100%;
      transform: rotate(20deg);
      direction: rtl;
      z-index: 1;
    }

    .left .content {
      direction: ltr;
    }

    .right {
      top: 0%;
      left: 47.5%;
      width: 4%;
      height: 100%;
      transform: rotate(-20deg);
      z-index: 1;
    }

    .f1, .f2 {
      left: 51%;
      top: 0%;
      width: 50%;
      height: 4%;
      transform: rotate(-20deg);
    }

    .f2 {
      left: 64%;
      top: 35%;
      width: 40%;
    }

    .content > div {
      opacity: 0;
      padding: 6%;
      text-align: left;
      transition: opacity var(--transition-time) ease;
    }

    .content div > h2 {
      text-align: center;
    }

    .f1.clicked, .f2.clicked, .left.clicked, .right.clicked {
      z-index:2;
    }

    .content.clicked {
      width: 2000%;
      cursor: default;
      height: auto;
      height: auto;
    }

    .f1 > .content,
    .f2 > .content {
      min-height: 100%;
      max-height: 100%;
      height: 100%;
      animation-delay: 1s;
    }

    .f1 > .content.clicked,
    .f2 > .content.clicked {
      width: 100%;
      height: max-content;
      height: 2000%;
      max-height: max-content;
    }
    
    .f2 > .content.clicked {
      width: 150%;
    }
    .content.clicked div {
      opacity: 1;
    }

    .social-icons {
      width: 100%;
      text-align: center;
    }

    .cross {
      left: 50%;
      top: 50%;
      width: 45%;
      clip-path: polygon(10% 0%, 90% 0%, 100% 100%, 0% 100%);
      transform: translateX(-50%);
    }    

    .social-icons {
      color: #fff;
      background-color: #2c71a3;
      font-family: initial;
    }

    .social-icons a {
      font-size: 2rem;
      width: 100%;
      color: #000;
      text-decoration: none;
      transition: color 0.3s;
      text-align: center;
      margin: 4em 0;
      padding: 0 4%;
      color: #000;
      text-decoration: none;
      transition: color 0.3s;
      text-align: center;
      margin: 4em 0;
      padding: 0 4%;
    }

    .social-icons a.clicked {
      color: #c5c762c2;
    }

    .no-transition {
      transition: none !important;
    }
  </style>
</head>

<body>

  <div id="logo-container">
    <div class="segment cross"><div class="social-icons">

        <a href="https://www.instagram.com/albertofortuna" target="_blank" aria-label="Instagram">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://www.facebook.com/albertofortuna" target="_blank" aria-label="Facebook">
          <i class="fab fa-facebook"></i>
        </a>

    </div></div>
    <div class="segment left"><div class="content clicked"><div><h2>Alberto Fortuna</h2><p>è un DJ italiano con uno stile distintivo che unisce house, techno ed elettronica melodica.<br>Formatosi nei club e festival italiani, trae ispirazione dalla scena europea e da sonorità sperimentali.<br>I suoi set variano da DJ set club-oriented a performance ibride con live electronics.</p></div></div></div>
    <div class="segment right"><div class="content clicked"><div><h2>Generi musicali e set disponibili</h2><ul><li>Set dal vivo</li><li>Set ibridi</li><li>B2b con altri artisti</li><li>Show tematici techno: house, EDM, hip-hop o crossover</li></div></div></div>
    <div class="segment f1"><div class="content clicked"><div><h2>SUCA</h2></div></div></div>
    <div class="segment f2"><div class="content clicked"><div><h2>Tour</h2><ul><li>20/03 - Milano</li><li>27/03 - Bologna</li><li>25/08 - Napoli</li></ul></div></div></div>
  </div>

  <script>

    let isRunning = true;
    let animationId = null;

    function sinusoide(t, freq = 1, amp = 1, phase = 0) {
      return amp * Math.sin(2 * Math.PI * freq * t + phase);
    }

    async function initAudio() {
      const container = document.getElementById('logo-container');

      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("Il tuo browser non supporta l'accesso al microfono.");
        return;
      }

      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (!AudioContext) {
        alert("Il tuo browser non supporta le Web Audio API.");
        return;
      }

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const audioCtx = new AudioContext();
        const source = audioCtx.createMediaStreamSource(stream);

        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        const dataArray = new Uint8Array(analyser.frequencyBinCount);

        source.connect(analyser);

        let currentScale = 1;
        let lastScale = 0;

        function animate() {

          if(isRunning) {
            container.style.transition = 'none';

            analyser.getByteTimeDomainData(dataArray);

            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
              const val = dataArray[i] - 128;
              sum += val * val;
            }
            const rms = Math.sqrt(sum / dataArray.length);

            const targetScale = 1 + Math.min(rms / 64, 0.2) * 2;
            const smoothing = 0.15;
            currentScale += (targetScale - currentScale) * smoothing;

            if (isRunning && Math.abs(currentScale - lastScale) > 0.01) {
              container.style.transform = `scale(${(currentScale).toFixed(3)})`;
              lastScale = currentScale;
            }
          }
          
          requestAnimationFrame(animate);          
        }

        animate();
      } catch (err) {
        console.error(err);
        alert("Errore durante l'accesso al microfono: " + err.message);
      }
    }

    function stopAudio() {
      isRunning = false;
    }

    function startAudio() {
      isRunning = true;
    }

    document.querySelectorAll('.content').forEach(content => {
      content.data = content.getBoundingClientRect();
      content.classList.remove('clicked');
    });

    window.addEventListener('resize', function () {
      stopAudio();
      resetZoom();
      document.querySelectorAll('.content').forEach(content => {
        let logo = document.getElementById('logo-container')
        logo.classList.add('no-transition');
        content.classList.add('clicked', 'no-transition');
        content.data = content.getBoundingClientRect();
        content.classList.remove('clicked', 'no-transition');
        logo.classList.remove('no-transition');
      });
    });

    initAudio();

    const logoContainer = document.getElementById('logo-container');

    logoContainer.style.opacity = 1;

    function zoomAndPanToElement(el) {
      
      const rect = el.data;
      const scaleX = window.innerWidth / rect.width;
      const scaleY = window.innerHeight / rect.height;
      const scale = Math.min(scaleX, scaleY); // per non ritagliare

      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;

      const offsetX = window.innerWidth / 2 - centerX;
      const offsetY = window.innerHeight / 2 - centerY;

      // Applica trasformazione
      logoContainer.style.transition = 'transform 0.8s ease';
      logoContainer.style.transform = `rotate(${getCurrentTransformValues(el.parentElement).rotation*-0.75}deg) translate(${offsetX*scale}px, ${offsetY*scale}px) scale(${scale})`;

    }

    // Ripristina trasformazioni al mouseout
    function resetZoom() {
      logoContainer.style.transform = 'scale(1) translate(0, 0)';
    }

    document.querySelectorAll('.content').forEach(content => {
      content.addEventListener('click', e => {
        stopAudio();
        document.body.style.cursor = 'pointer';
        zoomAndPanToElement(content);

        document.querySelectorAll('.content.clicked').forEach(el => {
          if (el !== content) el.classList.remove('clicked');
        });

        content.classList.add('clicked');
      });
    });

    document.body.addEventListener('click', (e) => {
      // Se clicchi fuori da qualsiasi .content, resetta lo zoom
      if (!e.target.closest('.content')) {
        document.body.style.cursor = 'default';

        logoContainer.addEventListener('transitionend', function handler(e) {       
          if (!isRunning && e.propertyName === 'width' || e.propertyName === 'height' || e.propertyName === 'scale') {              
            logoContainer.removeEventListener('transitionend', handler);
            startAudio();
          }
        });

        resetZoom();
        
        // Rimuove anche la classe .clicked da eventuali content attivi
        document.querySelectorAll('.content.clicked').forEach(el => {
          el.classList.remove('clicked');
        });
      }
    });

    function getCurrentTransformValues(el) {
      const computed = getComputedStyle(el).transform;

      if (!computed || computed === 'none') {
        return {
          translateX: 0,
          translateY: 0,
          scale: 1,
          rotation: 0 // in gradi
        };
      }

      const match = computed.match(/^matrix\(([^)]+)\)$/);
      if (!match) return null;

      const values = match[1].split(', ').map(parseFloat);
      const [a, b, c, d, e, f] = values;

      const scale = Math.sqrt(a * a + b * b); // solo se scala uniforme
      const rotationRad = Math.atan2(b, a);   // rotazione in radianti
      const rotationDeg = rotationRad * (180 / Math.PI); // converti in gradi

      return {
        scale: scale,
        translateX: e,
        translateY: f,
        rotation: rotationDeg
      };
    }
  </script>

</body>

</html>